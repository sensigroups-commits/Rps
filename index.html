<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Ø¢Ø±Ù†Ø§ | Ø³Ù†Ú¯ Ú©Ø§ØºØ° Ù‚ÛŒÚ†ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary: #6366f1;
            --primary-glow: rgba(99, 102, 241, 0.5);
            --success: #10b981;
            --success-glow: rgba(16, 185, 129, 0.5);
            --gold: #fbbf24;
            --gold-glow: rgba(251, 191, 36, 0.5);
            --silver: #94a3b8;
            --silver-glow: rgba(148, 163, 184, 0.5);
            --danger: #ef4444;
        }

        [data-theme="dark"] {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --text-primary: #ffffff;
            --text-secondary: #a0a0b0;
            --card-bg: rgba(20, 20, 30, 0.8);
            --border-color: rgba(255, 255, 255, 0.05);
            --shadow-color: rgba(0, 0, 0, 0.5);
            --theme-color: #1e1e2e;
            --theme-text: #ffffff;
        }

        [data-theme="light"] {
            --bg-primary: #f0f2f5;
            --bg-secondary: #ffffff;
            --text-primary: #1a1a1a;
            --text-secondary: #4a4a5a;
            --card-bg: rgba(255, 255, 255, 0.7);
            --border-color: rgba(0, 0, 0, 0.05);
            --shadow-color: rgba(0, 0, 0, 0.1);
            --theme-color: #f0f2f5;
            --theme-text: #1a1a1a;
        }

        body {
            font-family: 'Vazirmatn', 'Orbitron', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
            position: relative;
            transition: background-color 0.3s ease;
        }

        /* Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ú¯Ø±Ø§Ø¯ÛŒØ§Ù†Øª */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.2) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(16, 185, 129, 0.2) 0%, transparent 50%);
            animation: gradientMove 15s ease infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes gradientMove {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .container {
            position: relative;
            max-width: 500px;
            margin: 0 auto;
            padding: 12px;
            z-index: 1;
        }

        /* ========== Ù‡Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ ========== */
        .header {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 30px;
            padding: 12px 20px;
            margin-bottom: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .header h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 18px;
            background: linear-gradient(135deg, var(--primary), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-buttons {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        /* ========== Ø¯Ú©Ù…Ù‡ Ú©Ø´ÙˆÛŒÛŒ ØªÙ… ========== */
        .theme-switch {
            width: 70px;
            height: 36px;
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 40px;
            position: relative;
            cursor: pointer;
            overflow: hidden;
            box-shadow: 0 0 10px var(--primary-glow);
        }

        .theme-slider {
            width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            align-items: center;
            padding: 0 4px;
        }

        .theme-knob {
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, var(--primary), #818cf8);
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            z-index: 2;
        }

        .theme-knob.dark {
            transform: translateX(34px);
        }

        .theme-icon {
            position: absolute;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 10px;
            z-index: 1;
            font-size: 16px;
            color: var(--text-secondary);
            pointer-events: none;
        }

        .theme-icon span {
            filter: drop-shadow(0 0 5px gold);
            animation: iconFloat 3s ease infinite;
        }

        .theme-icon span:first-child {
            animation-delay: 0s;
        }

        .theme-icon span:last-child {
            animation-delay: 1.5s;
        }

        @keyframes iconFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-2px) rotate(10deg); }
        }

        /* ========== Ø¯Ú©Ù…Ù‡ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ ========== */
        .shop-btn {
            background: linear-gradient(135deg, var(--gold), #f59e0b);
            border: none;
            border-radius: 40px;
            padding: 8px 16px;
            color: white;
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px var(--gold-glow);
            position: relative;
            overflow: hidden;
        }

        .shop-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(transparent, rgba(255,255,255,0.3), transparent);
            animation: rotate 4s linear infinite;
        }

        .shop-btn span {
            position: relative;
            z-index: 2;
        }

        .shop-btn:active {
            transform: scale(0.95);
        }

        /* ========== Ù†ÙˆÛŒÚ¯ÛŒØ´Ù† Ø¨Ø§Ø²ÛŒ ========== */
        .game-nav {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .nav-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 30px;
            background: var(--card-bg);
            color: var(--text-primary);
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .nav-btn.active {
            background: linear-gradient(135deg, var(--primary), #818cf8);
            color: white;
            border-color: transparent;
            box-shadow: 0 0 20px var(--primary-glow);
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .nav-btn:active::before {
            width: 200px;
            height: 200px;
        }

        /* ========== Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù‚Ø§Ø¨ ========== */
        .profile-card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 30px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .profile-row {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .avatar-container {
            position: relative;
            width: 70px;
            height: 70px;
            flex-shrink: 0;
        }

        .avatar-frame {
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            border-radius: 50%;
            z-index: 1;
            pointer-events: none;
        }

        .avatar-img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            color: white;
            position: relative;
            z-index: 2;
            overflow: hidden;
        }

        .avatar-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-info {
            flex: 1;
            min-width: 150px;
        }

        .profile-name {
            font-size: 18px;
            font-weight: bold;
            font-family: 'Orbitron', sans-serif;
            margin-bottom: 4px;
        }

        .profile-stats {
            display: flex;
            gap: 12px;
            font-size: 13px;
            color: var(--text-secondary);
            flex-wrap: wrap;
        }

        .coins {
            background: linear-gradient(135deg, var(--gold), #f59e0b);
            padding: 4px 12px;
            border-radius: 30px;
            color: white;
            font-weight: bold;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-top: 8px;
        }

        /* ========== Ú©Ø§Ø±Øª Ø¨Ø§Ø²ÛŒ ========== */
        .game-section {
            display: none;
        }

        .game-section.active {
            display: block;
        }

        .game-card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 30px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .mode-switch {
            display: flex;
            gap: 8px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 40px;
            padding: 4px;
            margin-bottom: 20px;
        }

        .mode-option {
            flex: 1;
            padding: 10px;
            text-align: center;
            border-radius: 30px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mode-option.active {
            background: linear-gradient(135deg, var(--primary), #818cf8);
            color: white;
        }

        /* ========== Ø¨Ø§Ú©Ø³â€ŒÙ‡Ø§ÛŒ VS ========== */
        .vs-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .vs-box {
            flex: 1;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 25px;
            padding: 20px 10px;
            text-align: center;
            position: relative;
            animation: float 3s ease infinite;
        }

        .vs-box.player {
            animation-delay: 0s;
        }

        .vs-box.bot {
            animation-delay: 1.5s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .vs-box h3 {
            font-size: 14px;
            margin-bottom: 10px;
            color: var(--text-secondary);
        }

        .choice-display {
            font-size: 48px;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .vs-divider {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            text-shadow: 0 0 10px var(--primary-glow);
        }

        .score-badge {
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--primary), var(--success));
            color: white;
            padding: 4px 12px;
            border-radius: 30px;
            font-size: 12px;
            font-weight: bold;
            white-space: nowrap;
        }

        .result-message {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin: 15px 0;
            background: linear-gradient(135deg, var(--primary), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: pulse 2s ease infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        /* ========== Ø¯Ú©Ù…Ù‡ Ù…Ù†ÙˆÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø¹Ù†Ø§ØµØ± ========== */
        .choose-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary), #818cf8);
            border: none;
            border-radius: 40px;
            color: white;
            font-family: 'Orbitron', sans-serif;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 10px 0;
            position: relative;
            overflow: hidden;
            box-shadow: 0 5px 0 rgba(0, 0, 0, 0.2);
            transition: all 0.1s;
            z-index: 10;
        }

        .choose-btn:active {
            transform: translateY(5px);
            box-shadow: none;
        }

        .choose-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shine 2s infinite;
        }

        @keyframes shine {
            100% { left: 100%; }
        }

        .arrow-icon {
            font-size: 20px;
            transition: transform 0.3s;
        }

        .arrow-icon.open {
            transform: rotate(180deg);
        }

        /* ========== Ú¯Ø±ÛŒØ¯ Ø§Ù†ØªØ®Ø§Ø¨ Ø¹Ù†Ø§ØµØ± ========== */
        .choices-wrapper {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            margin-top: 0;
            background: var(--card-bg);
            border-radius: 30px;
            border: 1px solid var(--border-color);
            transform: scaleY(0);
            transform-origin: top;
        }

        .choices-wrapper.open {
            max-height: 400px;
            opacity: 1;
            margin-top: 10px;
            transform: scaleY(1);
            overflow-y: auto;
        }

        .choices-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            padding: 16px;
        }

        .choice-item {
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 20px;
            padding: 12px 4px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            animation: fadeInUp 0.5s ease backwards;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .choice-item:active {
            transform: scale(0.95);
            border-color: var(--primary);
            background: linear-gradient(135deg, var(--primary), #818cf8);
        }

        .choice-emoji {
            font-size: 30px;
            filter: drop-shadow(0 0 8px var(--primary-glow));
        }

        .choice-name {
            font-size: 11px;
            color: var(--text-secondary);
        }

        /* ========== Ø¨Ø®Ø´ Ø±Ø§Ù‡Ù†Ù…Ø§ ========== */
        .guide-wrapper {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            margin-top: 0;
            background: var(--card-bg);
            border-radius: 30px;
            border: 1px solid var(--border-color);
            transform: scaleY(0);
            transform-origin: top;
        }

        .guide-wrapper.open {
            max-height: 500px;
            opacity: 1;
            margin-top: 10px;
            transform: scaleY(1);
            overflow-y: auto;
        }

        .guide-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            padding: 16px;
        }

        .guide-item {
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 20px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .guide-item:hover {
            transform: translateY(-2px);
            border-color: var(--primary);
        }

        .guide-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .guide-details {
            display: none;
            font-size: 12px;
            color: var(--text-secondary);
            padding: 8px;
            background: rgba(0,0,0,0.2);
            border-radius: 15px;
        }

        .guide-item.active .guide-details {
            display: block;
        }

        .guide-wins {
            color: var(--success);
            margin-bottom: 4px;
        }

        .guide-loses {
            color: var(--danger);
        }

        .guide-emoji-list {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 4px;
        }

        /* ========== Ø¨Ø®Ø´ Ø¢Ù†Ù„Ø§ÛŒÙ† ========== */
        .online-section {
            text-align: center;
        }

        .room-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .room-input {
            flex: 1;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 30px;
            background: var(--card-bg);
            color: var(--text-primary);
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            min-width: 150px;
        }

        .room-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* ========== Ù„ÙˆØ¯ÛŒÙ†Ú¯ Ø®Ø±Ú†Ù†Ú¯ÛŒ ========== */
        .waiting-loader {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
            background: var(--card-bg);
            border-radius: 40px;
            margin: 20px 0;
        }

        .crab-loader {
            position: relative;
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
        }

        .crab-body {
            position: absolute;
            width: 60px;
            height: 40px;
            background: linear-gradient(135deg, #ff6b6b, #ff4757);
            border-radius: 30px 30px 20px 20px;
            top: 30px;
            left: 20px;
            animation: bodyFloat 2s ease infinite;
        }

        .crab-eye {
            position: absolute;
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            top: 35px;
        }

        .crab-eye.left {
            left: 35px;
        }

        .crab-eye.right {
            left: 53px;
        }

        .crab-eye::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            background: black;
            border-radius: 50%;
            top: 3px;
            left: 3px;
            animation: eyeMove 2s ease infinite;
        }

        .crab-leg {
            position: absolute;
            width: 15px;
            height: 25px;
            background: #ff4757;
            border-radius: 10px;
            bottom: 25px;
        }

        .crab-leg.left1 { left: 25px; transform: rotate(-20deg); animation: legMove1 1s ease infinite; }
        .crab-leg.left2 { left: 40px; transform: rotate(-30deg); animation: legMove2 1s ease infinite; }
        .crab-leg.right1 { left: 55px; transform: rotate(20deg); animation: legMove1 1s ease infinite reverse; }
        .crab-leg.right2 { left: 70px; transform: rotate(30deg); animation: legMove2 1s ease infinite reverse; }

        .crab-claw {
            position: absolute;
            width: 25px;
            height: 25px;
            background: #ff4757;
            border-radius: 50% 50% 0 50%;
            top: 25px;
        }

        .crab-claw.left {
            left: 10px;
            transform: rotate(-45deg);
            animation: clawWave 1.5s ease infinite;
        }

        .crab-claw.right {
            left: 65px;
            transform: rotate(45deg);
            animation: clawWave 1.5s ease infinite reverse;
        }

        .waiting-text {
            font-family: 'Orbitron', sans-serif;
            font-size: 16px;
            color: var(--primary);
            margin-top: 10px;
            display: flex;
            gap: 5px;
        }

        .dot {
            animation: dotPulse 1.5s ease infinite;
        }

        .dot:nth-child(2) { animation-delay: 0.5s; }
        .dot:nth-child(3) { animation-delay: 1s; }

        @keyframes bodyFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        @keyframes eyeMove {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(2px); }
        }

        @keyframes legMove1 {
            0%, 100% { transform: rotate(-20deg); }
            50% { transform: rotate(-40deg); }
        }

        @keyframes legMove2 {
            0%, 100% { transform: rotate(-30deg); }
            50% { transform: rotate(-50deg); }
        }

        @keyframes clawWave {
            0%, 100% { transform: rotate(-45deg) scale(1); }
            50% { transform: rotate(-60deg) scale(1.1); }
        }

        @keyframes dotPulse {
            0%, 100% { opacity: 0.3; transform: translateY(0); }
            50% { opacity: 1; transform: translateY(-3px); }
        }

        /* ========== ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ù‚Ø§Ø¨â€ŒÙ‡Ø§ ========== */
        .shop-section {
            display: none;
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 30px;
            padding: 20px;
            margin-top: 16px;
            max-height: 500px;
            overflow-y: auto;
        }

        .shop-section.active {
            display: block;
        }

        .shop-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 18px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .frame-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .frame-preview {
            width: 60px;
            height: 60px;
            position: relative;
            flex-shrink: 0;
        }

        .preview-avatar {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            position: relative;
            z-index: 2;
        }

        .preview-frame {
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            border-radius: 50%;
            z-index: 1;
        }

        .frame-info {
            flex: 1;
        }

        .frame-name {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .frame-price {
            color: var(--gold);
            font-size: 13px;
        }

        .buy-btn {
            background: linear-gradient(135deg, var(--primary), #818cf8);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 30px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            min-width: 70px;
        }

        .buy-btn.owned {
            background: var(--success);
        }

        .buy-btn:disabled {
            opacity: 0.5;
        }

        /* ÙÙˆØªØ± */
        .footer {
            margin-top: 20px;
            padding: 16px;
            text-align: center;
            font-size: 12px;
            color: var(--text-secondary);
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 30px;
        }

        @media (max-width: 400px) {
            .header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .header h1 {
                text-align: center;
            }
            
            .header-buttons {
                justify-content: center;
            }
            
            .profile-row {
                justify-content: center;
                text-align: center;
            }
            
            .profile-stats {
                justify-content: center;
            }
        }
    </style>
</head>
<body data-theme="dark">
    <div class="container">
        <!-- Ù‡Ø¯Ø± Ø¨Ø§ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ -->
        <header class="header">
            <h1>âš¡ ARENA</h1>
            <div class="header-buttons">
                <!-- Ø¯Ú©Ù…Ù‡ Ú©Ø´ÙˆÛŒÛŒ ØªÙ… -->
                <div class="theme-switch" onclick="toggleTheme()">
                    <div class="theme-slider">
                        <div class="theme-knob" id="themeKnob"></div>
                        <div class="theme-icon">
                            <span>ğŸŒ™</span>
                            <span>â˜€ï¸</span>
                        </div>
                    </div>
                </div>
                <!-- Ø¯Ú©Ù…Ù‡ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ -->
                <button class="shop-btn" onclick="showSection('shop')">
                    <span>ğŸ›’</span>
                    <span>ÙØ±ÙˆØ´Ú¯Ø§Ù‡</span>
                </button>
            </div>
        </header>

        <!-- Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù‚Ø§Ø¨ -->
        <div class="profile-card">
            <div class="profile-row">
                <div class="avatar-container" id="avatarContainer">
                    <div class="avatar-frame" id="avatarFrame"></div>
                    <div class="avatar-img" id="avatarImg">ğŸ‘¤</div>
                </div>
                <div class="profile-info">
                    <div class="profile-name" id="userName">Ú©Ø§Ø±Ø¨Ø±</div>
                    <div class="profile-stats">
                        <span>ğŸ† <span id="userWins">Û°</span></span>
                        <span>â­ Ø³Ø·Ø­ <span id="userLevel">Û±</span></span>
                    </div>
                    <div class="coins" id="userCoins">ğŸ’° ÛµÛ°Û°Û°</div>
                </div>
            </div>
        </div>

        <!-- Ù†ÙˆÛŒÚ¯ÛŒØ´Ù† Ø¨Ø§Ø²ÛŒ -->
        <div class="game-nav">
            <button class="nav-btn" onclick="showSection('bot')">ğŸ¤– Ø¨Ø§ Ø±Ø¨Ø§Øª</button>
            <button class="nav-btn" onclick="showSection('online')">ğŸŒ Ø¢Ù†Ù„Ø§ÛŒÙ†</button>
        </div>

        <!-- Ø¨Ø®Ø´ Ø¨Ø§Ø²ÛŒ Ø¨Ø§ Ø±Ø¨Ø§Øª -->
        <div id="botSection" class="game-section">
            <div class="game-card">
                <div class="mode-switch">
                    <div class="mode-option" onclick="setGameMode('easy')">ğŸ˜Š Ø¢Ø³Ø§Ù†</div>
                    <div class="mode-option" onclick="setGameMode('advanced')">ğŸ”¥ Ù¾ÛŒØ´Ø±ÙØªÙ‡</div>
                </div>

                <div class="vs-container">
                    <div class="vs-box player">
                        <div class="score-badge" id="playerScore">Û°</div>
                        <h3>Ø´Ù…Ø§</h3>
                        <div class="choice-display" id="playerChoice">â“</div>
                    </div>
                    <div class="vs-divider">VS</div>
                    <div class="vs-box bot">
                        <div class="score-badge" id="botScore">Û°</div>
                        <h3>Ø±Ø¨Ø§Øª</h3>
                        <div class="choice-display" id="botChoice">â“</div>
                    </div>
                </div>

                <div class="result-message" id="resultMessage">âœ¨ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ âœ¨</div>

                <!-- Ø¯Ú©Ù…Ù‡ Ø±Ø§Ù‡Ù†Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø­Ø§Ù„Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡ -->
                <div id="advancedGuideBtn" style="display: none;">
                    <button class="choose-btn" onclick="toggleGuide()" style="margin-bottom: 10px; background: linear-gradient(135deg, #f59e0b, #fbbf24);">
                        <span class="arrow-icon" id="guideArrow">â–¼</span>
                        <span>ğŸ“š Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¹Ù†Ø§ØµØ±</span>
                        <span class="arrow-icon">â–¼</span>
                    </button>
                    <div class="guide-wrapper" id="guideWrapper">
                        <div class="guide-grid" id="guideGrid"></div>
                    </div>
                </div>

                <button class="choose-btn" onclick="toggleChoices()">
                    <span class="arrow-icon" id="arrowIcon">â–¼</span>
                    <span id="btnText">Ø¹Ù†Ø§ØµØ± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</span>
                    <span class="arrow-icon" id="arrowIcon2">â–¼</span>
                </button>

                <div class="choices-wrapper" id="choicesWrapper">
                    <div class="choices-grid" id="choicesGrid"></div>
                </div>
            </div>
        </div>

        <!-- Ø¨Ø®Ø´ Ø¨Ø§Ø²ÛŒ Ø¢Ù†Ù„Ø§ÛŒÙ† -->
        <div id="onlineSection" class="game-section">
            <div class="game-card">
                <div class="online-section">
                    <div class="room-controls">
                        <input type="text" id="roomId" class="room-input" placeholder="Ú©Ø¯ Ø§ØªØ§Ù‚">
                        <button class="choose-btn" onclick="createRoom()" style="margin: 0; padding: 12px;">Ø³Ø§Ø®Øª Ø§ØªØ§Ù‚</button>
                        <button class="choose-btn" onclick="joinRoom()" style="margin: 0; padding: 12px; background: linear-gradient(135deg, #10b981, #059669);">ÙˆØ±ÙˆØ¯</button>
                    </div>

                    <div id="onlineGameArea" style="display: none;">
                        <div class="vs-container">
                            <div class="vs-box player">
                                <div class="score-badge" id="onlinePlayerScore">Û°</div>
                                <h3>Ø´Ù…Ø§</h3>
                                <div class="choice-display" id="onlinePlayerChoice">â“</div>
                            </div>
                            <div class="vs-divider">VS</div>
                            <div class="vs-box bot">
                                <div class="score-badge" id="onlineOpponentScore">Û°</div>
                                <h3>Ø­Ø±ÛŒÙ</h3>
                                <div class="choice-display" id="onlineOpponentChoice">â“</div>
                            </div>
                        </div>

                        <div class="result-message" id="onlineResult">Ù…Ù†ØªØ¸Ø± Ø­Ø±ÛŒÙ...</div>

                        <!-- Ù„ÙˆØ¯ÛŒÙ†Ú¯ Ø®Ø±Ú†Ù†Ú¯ÛŒ -->
                        <div id="waitingLoader" class="waiting-loader" style="display: none;">
                            <div class="crab-loader">
                                <div class="crab-body"></div>
                                <div class="crab-eye left"></div>
                                <div class="crab-eye right"></div>
                                <div class="crab-leg left1"></div>
                                <div class="crab-leg left2"></div>
                                <div class="crab-leg right1"></div>
                                <div class="crab-leg right2"></div>
                                <div class="crab-claw left"></div>
                                <div class="crab-claw right"></div>
                            </div>
                            <div class="waiting-text">
                                <span>Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø­Ø±ÛŒÙ</span>
                                <span class="dot">.</span>
                                <span class="dot">.</span>
                                <span class="dot">.</span>
                            </div>
                        </div>

                        <div class="mode-switch" style="margin-top: 20px;">
                            <div class="mode-option active" onclick="setOnlineMode('easy')">ğŸ˜Š Ø¢Ø³Ø§Ù†</div>
                            <div class="mode-option" onclick="setOnlineMode('advanced')">ğŸ”¥ Ù¾ÛŒØ´Ø±ÙØªÙ‡</div>
                        </div>

                        <button class="choose-btn" onclick="toggleOnlineChoices()">
                            <span class="arrow-icon" id="onlineArrowIcon">â–¼</span>
                            <span id="onlineBtnText">Ø¹Ù†Ø§ØµØ± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</span>
                            <span class="arrow-icon">â–¼</span>
                        </button>

                        <div class="choices-wrapper" id="onlineChoicesWrapper">
                            <div class="choices-grid" id="onlineChoicesGrid"></div>
                        </div>

                        <button class="choose-btn" onclick="leaveRoom()" style="background: linear-gradient(135deg, #ef4444, #dc2626); margin-top: 10px;">Ø®Ø±ÙˆØ¬ Ø§Ø² Ø§ØªØ§Ù‚</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ø¨Ø®Ø´ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ -->
        <div id="shopSection" class="shop-section">
            <div class="shop-title">
                <span>ğŸ›’</span> Ù‚Ø§Ø¨â€ŒÙ‡Ø§ÛŒ Ù…ØªØ§Ù„ÛŒÚ© (Û±Û°Û° Ù‚Ø§Ø¨ ÙˆÛŒÚ˜Ù‡)
            </div>
            <div id="framesList"></div>
        </div>

        <!-- ÙÙˆØªØ± -->
        <div class="footer">
            <span>ğŸ”¥ Streak: <span id="streakDisplay">Û°</span></span>
            <span style="margin: 0 15px;">â€¢</span>
            <span>ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø±</span>
        </div>
    </div>

    <script>
        // ========== Ù‚ÙˆØ§Ù†ÛŒÙ† Ø¨Ø§Ø²ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ ==========
        const advancedRules = {
            'Ú¯Ø±Ú¯': { loses: ['ØªÙÙ†Ú¯', 'Ø³Ù†Ú¯', 'Ø¢ØªØ´', 'Ù‚ÛŒÚ†ÛŒ', 'Ù…Ø§Ø±', 'Ø§Ù†Ø³Ø§Ù†', 'Ø¯Ø±Ø®Øª'], wins: ['ØµØ§Ø¹Ù‚Ù‡', 'Ø´ÛŒØ·Ø§Ù†', 'Ø§Ú˜Ø¯Ù‡Ø§', 'Ø¢Ø¨', 'Ø¨Ø§Ø¯', 'Ú©Ø§ØºØ°', 'Ø§Ø³ÙÙ†Ø¬'] },
            'Ø¯Ø±Ø®Øª': { loses: ['ØµØ§Ø¹Ù‚Ù‡', 'ØªÙÙ†Ú¯', 'Ø³Ù†Ú¯', 'Ø¢ØªØ´', 'Ù‚ÛŒÚ†ÛŒ', 'Ù…Ø§Ø±', 'Ø§Ù†Ø³Ø§Ù†'], wins: ['Ø´ÛŒØ·Ø§Ù†', 'Ø§Ú˜Ø¯Ù‡Ø§', 'Ø¢Ø¨', 'Ø¨Ø§Ø¯', 'Ú©Ø§ØºØ°', 'Ø§Ø³ÙÙ†Ø¬', 'Ú¯Ø±Ú¯'] },
            'Ø§Ù†Ø³Ø§Ù†': { loses: ['Ù‚ÛŒÚ†ÛŒ', 'Ø¢ØªØ´', 'Ø³Ù†Ú¯', 'ØªÙÙ†Ú¯', 'ØµØ§Ø¹Ù‚Ù‡', 'Ø´ÛŒØ·Ø§Ù†'], wins: ['Ø¯Ø±Ø®Øª', 'Ú¯Ø±Ú¯', 'Ø§Ø³ÙÙ†Ø¬', 'Ú©Ø§ØºØ°', 'Ø¨Ø§Ø¯', 'Ø¢Ø¨', 'Ø§Ú˜Ø¯Ù‡Ø§'] },
            'Ù…Ø§Ø±': { loses: ['Ù‚ÛŒÚ†ÛŒ', 'Ø¢ØªØ´', 'Ø³Ù†Ú¯', 'ØªÙÙ†Ú¯', 'ØµØ§Ø¹Ù‚Ù‡', 'Ø§Ú˜Ø¯Ù‡Ø§', 'Ø´ÛŒØ·Ø§Ù†'], wins: ['Ø¢Ø¨', 'Ø¨Ø§Ø¯', 'Ú©Ø§ØºØ°', 'Ø§Ø³ÙÙ†Ø¬', 'Ú¯Ø±Ú¯', 'Ø¯Ø±Ø®Øª', 'Ø§Ù†Ø³Ø§Ù†'] },
            'Ù‚ÛŒÚ†ÛŒ': { loses: ['Ø¢ØªØ´', 'Ø³Ù†Ú¯', 'ØªÙÙ†Ú¯', 'ØµØ§Ø¹Ù‚Ù‡', 'Ø´ÛŒØ·Ø§Ù†', 'Ø§Ú˜Ø¯Ù‡Ø§', 'Ø¢Ø¨'], wins: ['Ù…Ø§Ø±', 'Ø§Ù†Ø³Ø§Ù†', 'Ø¯Ø±Ø®Øª', 'Ú¯Ø±Ú¯', 'Ø§Ø³ÙÙ†Ø¬', 'Ú©Ø§ØºØ°', 'Ø¨Ø§Ø¯'] },
            'Ø¢ØªØ´': { loses: ['Ø³Ù†Ú¯', 'ØªÙÙ†Ú¯', 'ØµØ§Ø¹Ù‚Ù‡', 'Ø´ÛŒØ·Ø§Ù†', 'Ø§Ú˜Ø¯Ù‡Ø§', 'Ø¢Ø¨', 'Ø¨Ø§Ø¯'], wins: ['Ú©Ø§ØºØ°', 'Ø§Ø³ÙÙ†Ø¬', 'Ú¯Ø±Ú¯', 'Ø¯Ø±Ø®Øª', 'Ø§Ù†Ø³Ø§Ù†', 'Ù…Ø§Ø±', 'Ù‚ÛŒÚ†ÛŒ'] },
            'Ø³Ù†Ú¯': { loses: ['ØªÙÙ†Ú¯', 'ØµØ§Ø¹Ù‚Ù‡', 'Ø´ÛŒØ·Ø§Ù†', 'Ø§Ú˜Ø¯Ù‡Ø§', 'Ø¢Ø¨', 'Ø¨Ø§Ø¯', 'Ú©Ø§ØºØ°'], wins: ['Ø§Ø³ÙÙ†Ø¬', 'Ú¯Ø±Ú¯', 'Ø¯Ø±Ø®Øª', 'Ø§Ù†Ø³Ø§Ù†', 'Ù…Ø§Ø±', 'Ù‚ÛŒÚ†ÛŒ', 'Ø¢ØªØ´'] },
            'ØªÙÙ†Ú¯': { loses: ['ØµØ§Ø¹Ù‚Ù‡', 'Ø´ÛŒØ·Ø§Ù†', 'Ø§Ú˜Ø¯Ù‡Ø§', 'Ø¢Ø¨', 'Ø¨Ø§Ø¯', 'Ú©Ø§ØºØ°', 'Ø§Ø³ÙÙ†Ø¬'], wins: ['Ú¯Ø±Ú¯', 'Ø¯Ø±Ø®Øª', 'Ø§Ù†Ø³Ø§Ù†', 'Ù…Ø§Ø±', 'Ù‚ÛŒÚ†ÛŒ', 'Ø¢ØªØ´', 'Ø³Ù†Ú¯'] },
            'ØµØ§Ø¹Ù‚Ù‡': { loses: ['Ø´ÛŒØ·Ø§Ù†', 'Ø§Ú˜Ø¯Ù‡Ø§', 'Ø¢Ø¨', 'Ø¨Ø§Ø¯', 'Ú©Ø§ØºØ°', 'Ø§Ø³ÙÙ†Ø¬', 'Ú¯Ø±Ú¯'], wins: ['Ø¯Ø±Ø®Øª', 'Ø§Ù†Ø³Ø§Ù†', 'Ù…Ø§Ø±', 'Ù‚ÛŒÚ†ÛŒ', 'Ø¢ØªØ´', 'Ø³Ù†Ú¯', 'ØªÙÙ†Ú¯'] },
            'Ø´ÛŒØ·Ø§Ù†': { loses: ['Ø§Ú˜Ø¯Ù‡Ø§', 'Ø¢Ø¨', 'Ø¨Ø§Ø¯', 'Ú©Ø§ØºØ°', 'Ø§Ø³ÙÙ†Ø¬', 'Ú¯Ø±Ú¯', 'Ø¯Ø±Ø®Øª'], wins: ['Ø§Ù†Ø³Ø§Ù†', 'Ù…Ø§Ø±', 'Ù‚ÛŒÚ†ÛŒ', 'Ø¢ØªØ´', 'Ø³Ù†Ú¯', 'ØªÙÙ†Ú¯', 'ØµØ§Ø¹Ù‚Ù‡'] },
            'Ø§Ú˜Ø¯Ù‡Ø§': { loses: ['Ø¢Ø¨', 'Ø¨Ø§Ø¯', 'Ú©Ø§ØºØ°', 'Ø§Ø³ÙÙ†Ø¬', 'Ú¯Ø±Ú¯', 'Ø¯Ø±Ø®Øª', 'Ø§Ù†Ø³Ø§Ù†'], wins: ['Ù…Ø§Ø±', 'Ù‚ÛŒÚ†ÛŒ', 'Ø¢ØªØ´', 'Ø³Ù†Ú¯', 'ØªÙÙ†Ú¯', 'ØµØ§Ø¹Ù‚Ù‡', 'Ø´ÛŒØ·Ø§Ù†'] },
            'Ø¢Ø¨': { loses: ['Ø¨Ø§Ø¯', 'Ú©Ø§ØºØ°', 'Ø§Ø³ÙÙ†Ø¬', 'Ú¯Ø±Ú¯', 'Ø¯Ø±Ø®Øª', 'Ø§Ù†Ø³Ø§Ù†', 'Ù…Ø§Ø±'], wins: ['Ù‚ÛŒÚ†ÛŒ', 'Ø¢ØªØ´', 'Ø³Ù†Ú¯', 'ØªÙÙ†Ú¯', 'ØµØ§Ø¹Ù‚Ù‡', 'Ø´ÛŒØ·Ø§Ù†', 'Ø§Ú˜Ø¯Ù‡Ø§'] },
            'Ø¨Ø§Ø¯': { loses: ['Ú©Ø§ØºØ°', 'Ø§Ø³ÙÙ†Ø¬', 'Ú¯Ø±Ú¯', 'Ø¯Ø±Ø®Øª', 'Ø§Ù†Ø³Ø§Ù†', 'Ù…Ø§Ø±', 'Ù‚ÛŒÚ†ÛŒ'], wins: ['Ø¢ØªØ´', 'Ø³Ù†Ú¯', 'ØªÙÙ†Ú¯', 'ØµØ§Ø¹Ù‚Ù‡', 'Ø§Ú˜Ø¯Ù‡Ø§', 'Ø´ÛŒØ·Ø§Ù†', 'Ø¢Ø¨'] },
            'Ú©Ø§ØºØ°': { loses: ['Ø§Ø³ÙÙ†Ø¬', 'Ú¯Ø±Ú¯', 'Ø¯Ø±Ø®Øª', 'Ø§Ù†Ø³Ø§Ù†', 'Ù…Ø§Ø±', 'Ù‚ÛŒÚ†ÛŒ', 'Ø¢ØªØ´'], wins: ['Ø³Ù†Ú¯', 'ØªÙÙ†Ú¯', 'ØµØ§Ø¹Ù‚Ù‡', 'Ø´ÛŒØ·Ø§Ù†', 'Ø§Ú˜Ø¯Ù‡Ø§', 'Ø¢Ø¨', 'Ø¨Ø§Ø¯'] },
            'Ø§Ø³ÙÙ†Ø¬': { loses: ['Ú¯Ø±Ú¯', 'Ø¯Ø±Ø®Øª', 'Ø§Ù†Ø³Ø§Ù†', 'Ù…Ø§Ø±', 'Ù‚ÛŒÚ†ÛŒ', 'Ø¢ØªØ´', 'Ø³Ù†Ú¯'], wins: ['ØªÙÙ†Ú¯', 'ØµØ§Ø¹Ù‚Ù‡', 'Ø´ÛŒØ·Ø§Ù†', 'Ø§Ú˜Ø¯Ù‡Ø§', 'Ø¢Ø¨', 'Ø¨Ø§Ø¯', 'Ú©Ø§ØºØ°'] }
        };

        // Ø¹Ù†Ø§ØµØ± Ø¨Ø§Ø²ÛŒ
        const elements = {
            easy: [
                { name: 'Ø³Ù†Ú¯', emoji: 'ğŸª¨' },
                { name: 'Ú©Ø§ØºØ°', emoji: 'ğŸ“„' },
                { name: 'Ù‚ÛŒÚ†ÛŒ', emoji: 'âœ‚ï¸' }
            ],
            advanced: [
                { name: 'Ø³Ù†Ú¯', emoji: 'ğŸª¨' }, { name: 'Ú©Ø§ØºØ°', emoji: 'ğŸ“„' }, { name: 'Ù‚ÛŒÚ†ÛŒ', emoji: 'âœ‚ï¸' },
                { name: 'ØªÙÙ†Ú¯', emoji: 'ğŸ”«' }, { name: 'ØµØ§Ø¹Ù‚Ù‡', emoji: 'âš¡' }, { name: 'Ø´ÛŒØ·Ø§Ù†', emoji: 'ğŸ˜ˆ' },
                { name: 'Ø§Ú˜Ø¯Ù‡Ø§', emoji: 'ğŸ‰' }, { name: 'Ø¢Ø¨', emoji: 'ğŸ’§' }, { name: 'Ø¨Ø§Ø¯', emoji: 'ğŸŒªï¸' },
                { name: 'Ø§Ø³ÙÙ†Ø¬', emoji: 'ğŸ§½' }, { name: 'Ú¯Ø±Ú¯', emoji: 'ğŸº' }, { name: 'Ø¯Ø±Ø®Øª', emoji: 'ğŸŒ³' },
                { name: 'Ø§Ù†Ø³Ø§Ù†', emoji: 'ğŸ‘¤' }, { name: 'Ù…Ø§Ø±', emoji: 'ğŸ' }, { name: 'Ø¢ØªØ´', emoji: 'ğŸ”¥' }
            ]
        };

        // ========== Û±Û°Û° Ù‚Ø§Ø¨ Ù…ØªØ§Ù„ÛŒÚ© ==========
        const frames = Array.from({ length: 100 }, (_, i) => ({
            id: i + 1,
            name: `Ù‚Ø§Ø¨ Ø´Ù…Ø§Ø±Ù‡ ${i + 1}`,
            class: `frame-${i + 1}`,
            price: Math.floor((i + 1) * 100)
        }));

        const specialNames = [
            'Ù†Ø¦ÙˆÙ† Ø³Ø§Ø¯Ù‡', 'Ù†Ø¦ÙˆÙ† Ú¯Ø±Ø§Ø¯ÛŒØ§Ù†Øª', 'Ú¯Ù„Ùˆ ØªÙ†ÙØ³ÛŒ', 'Ú¯Ù„Ùˆ Ø¶Ø±Ø¨Ø§Ù†ÛŒ', 'Ù‡Ø§Ù„Ù‡ Ù†ÙˆØ± Ù†Ø±Ù…',
            'Ù†ÙˆØ± RGB Ú†Ø±Ø®Ø´ÛŒ', 'Ù†ÙˆØ± Ù„ÛŒØ²Ø±ÛŒ', 'Ù†ÙˆØ± Ù…ÙˆØ¬ÛŒ', 'Ù†ÙˆØ± Ø¯Ù†Ø¨Ø§Ù„Ù‡â€ŒØ¯Ø§Ø±', 'Ú¯Ù„Ùˆ Ø¯ÙˆØ¨Ù„',
            'Ø´Ø¹Ù„Ù‡ Ø¢ØªØ´', 'Ø¨Ø±Ù‚ ØµØ§Ø¹Ù‚Ù‡â€ŒØ§ÛŒ', 'Ø§Ù†Ø±Ú˜ÛŒ Ø¢Ø¨ÛŒ', 'Ù‡Ø§Ù„Ù‡ Ø¬Ø§Ø¯ÙˆÛŒÛŒ', 'Ø°Ø±Ø§Øª Ø§Ù†Ø±Ú˜ÛŒ',
            'Ù…ÙˆØ¬ Ø§Ù†Ø±Ú˜ÛŒ', 'Ø­Ù„Ù‚Ù‡ Ù¾Ù„Ø§Ø³Ù…Ø§', 'Ø§Ù†ÙØ¬Ø§Ø± Ø¢Ø±Ø§Ù…', 'Ø¯ÙˆØ¯ Ù†Ø±Ù…', 'Ù¾Ø§Ù„Ø³ Ø§Ù†Ø±Ú˜ÛŒ',
            'Ú¯Ø±Ø§Ø¯ÛŒØ§Ù†Øª Ú†Ø±Ø®Ø§Ù†', 'Ø±Ù†Ú¯ÛŒÙ†â€ŒÚ©Ù…Ø§Ù†ÛŒ', 'Ø®Ø·ÛŒ Ù…ØªØ­Ø±Ú©', 'Ú¯Ø±Ø§Ø¯ÛŒØ§Ù†Øª Ù…ÙˆØ±Ø¨', 'Ú¯Ø±Ø§Ø¯ÛŒØ§Ù†Øª Ø·Ù„Ø§ÛŒÛŒ',
            'Ø¨Ù†ÙØ´-Ø¢Ø¨ÛŒ', 'Ù…ØªØ§Ù„ÛŒÚ©', 'Ø´ÛŒØ´Ù‡â€ŒØ§ÛŒ', 'Ù†Ø±Ù… Ù¾Ø±ÛŒÙ…ÛŒÙˆÙ…', 'Ú¯Ø±Ø§Ø¯ÛŒØ§Ù†Øª Ù…ÙˆØ¬ÛŒ',
            'Ø·Ù„Ø§ÛŒÛŒ Ø¨Ø±Ø§Ù‚', 'Ù¾Ù„Ø§ØªÛŒÙ†ÛŒÙˆÙ…ÛŒ', 'Ø§Ù„Ù…Ø§Ø³ÛŒ', 'Ú©Ø±ÛŒØ³ØªØ§Ù„ÛŒ', 'Ø´ÛŒØ´Ù‡ ØªØ±Ø§Ø´',
            'Ù…ØªØ§Ù„ Ø¨Ø±Ø³â€ŒØ®ÙˆØ±Ø¯Ù‡', 'Ø³Ù„Ø·Ù†ØªÛŒ', 'Ù…Ø´Ú©ÛŒ Ø·Ù„Ø§ÛŒÛŒ', 'VIP', 'Ù‡ÙˆÙ„ÙˆÚ¯Ø±Ø§ÙÛŒÚ©',
            'Ø®Ø· Ù†Ø§Ø²Ú©', 'Ù†Ù‚Ø·Ù‡â€ŒÚ†ÛŒÙ†', 'dashed Ù…ØªØ­Ø±Ú©', 'Ú¯ÙˆØ´Ù‡â€ŒØ¯Ø§Ø± Ù…Ø¯Ø±Ù†', 'Ø¯ÙˆØ®Ø·ÛŒ Ø¸Ø±ÛŒÙ',
            'Ù…Ø­Ùˆ Ø´ÙˆÙ†Ø¯Ù‡', 'Ù†ÛŒÙ…Ù‡â€ŒØ¯Ø§ÛŒØ±Ù‡', 'Ú¯ÙˆØ´Ù‡ Ù†ÙˆØ±Ø§Ù†ÛŒ', 'Ø®Ø· Ø§Ø³Ú©Ù†', 'Ù…ÛŒÙ†ÛŒÙ…Ø§Ù„ ØªÙ†ÙØ³ÛŒ',
            'HUD Ú¯ÛŒÙ…Ø±ÛŒ', 'Ø³Ø§ÛŒØ¨Ø±Ù¾Ø§Ù†Ú©', 'Ù¾ÛŒÚ©Ø³Ù„ÛŒ', 'Ø¢Ø±Ú©ÛŒØ¯', 'Ø±ØªØ±Ùˆ Ú¯ÛŒÙ…',
            'Ø¯ÛŒØ¬ÛŒØªØ§Ù„ Ø§Ø³Ú©Ù†', 'Ù…Ø§ØªØ±ÛŒÚ©Ø³ÛŒ', 'Ú¯Ù„ÛŒÚ†', 'Ù„ÛŒØ²Ø±ÛŒ Ú¯ÛŒÙ…', 'XP Ù„ÙˆÙ„â€ŒØ¯Ø§Ø±',
            'Ø¬Ø§Ø¯ÙˆÛŒÛŒ', 'Ù¾Ø±ÛŒ Ø¯Ø±ÛŒØ§ÛŒÛŒ', 'Ø³ØªØ§Ø±Ù‡â€ŒØ§ÛŒ', 'Ú©Ù‡Ú©Ø´Ø§Ù†ÛŒ', 'Ù…Ù‡ Ø¨Ù†ÙØ´',
            'Ø´ÙÙ‚ Ù‚Ø·Ø¨ÛŒ', 'Ú¯Ø±Ø¯ Ø¬Ø§Ø¯ÙˆÛŒÛŒ', 'Ø±ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø³ØªØ§Ù†ÛŒ', 'Ù†ÙˆØ± Ù¾Ø±ÛŒ', 'Ù¾ÙˆØ±ØªØ§Ù„',
            'Ø¨Ø±Ú¯â€ŒÙ‡Ø§ÛŒ Ù…ØªØ­Ø±Ú©', 'Ø´Ú©ÙˆÙÙ‡â€ŒÙ‡Ø§ÛŒ Ø´Ù†Ø§ÙˆØ±', 'Ø¨Ø±Ù Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ø´', 'Ø¨Ø§Ø±Ø§Ù† Ù†Ø±Ù…', 'Ù…ÙˆØ¬ Ø¢Ø¨',
            'Ø¯ÙˆØ¯ Ù…Ù‡â€ŒØ¢Ù„ÙˆØ¯', 'Ø­Ø¨Ø§Ø¨â€ŒÙ‡Ø§ÛŒ Ø¢Ø¨', 'Ù‚Ø§Ø¨ Ú†ÙˆØ¨ÛŒ', 'Ù‚Ø§Ø¨ Ø³Ù†Ú¯ÛŒ', 'Ø¬Ù†Ú¯Ù„ÛŒ',
            'Ú†Ø±Ø®Ø§Ù† Ú©Ø§Ù…Ù„', 'Ù„Ø±Ø²Ø´ÛŒ Ù†Ø±Ù…', 'bounce Ø¢Ø±Ø§Ù…', 'ØªØ§ÛŒÙ…Ø± Ø¯ÙˆØ±Ø§Ù†ÛŒ', 'Ø§Ø³Ú©Ù† Ø±Ø§Ø¯Ø§Ø±ÛŒ',
            'Ù…ÙˆØ¬ Ø³ÛŒÙ†ÙˆØ³ÛŒ', 'orbit Ø°Ø±Ø§Øª', 'Ø¯Ù†Ø¨Ø§Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ù…ÙˆØ³', 'ÙˆØ§Ú©Ù†Ø´ÛŒ Ø¨Ù‡ Ú©Ù„ÛŒÚ©', 'visualizer',
            'Ø¨Ø±Ù†Ø²ÛŒ', 'Ù†Ù‚Ø±Ù‡â€ŒØ§ÛŒ', 'Ø·Ù„Ø§ÛŒÛŒ Ø±Ù†Ú©', 'Ø§ÙØ³Ø§Ù†Ù‡â€ŒØ§ÛŒ', 'Ù‚Ù‡Ø±Ù…Ø§Ù† ÙØµÙ„',
            'ØªØ§Ù¾ Ù„ÛŒØ¯Ø±Ø¨ÙˆØ±Ø¯', 'Ø§Ø³ØªØ±ÛŒÚ© Ø¨Ø§Ù„Ø§', 'VIP ÙˆÛŒÚ˜Ù‡', 'Ø§ÛŒÙˆÙ†Øª Ù…Ø­Ø¯ÙˆØ¯', 'Ù¾Ø±Ø³ØªÛŒÚ˜'
        ];

        specialNames.forEach((name, idx) => { if (frames[idx]) frames[idx].name = name; });

        // ========== Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± ==========
        let userData = {
            name: 'Ú©Ø§Ø±Ø¨Ø±',
            coins: 5000,
            ownedFrames: [1],
            currentFrame: 1,
            wins: 0,
            level: 1,
            streak: 0,
            gameStats: {
                playerScore: 0,
                botScore: 0
            }
        };

        let currentMode = 'easy';
        let onlineMode = 'easy';
        let choicesOpen = false;
        let guideOpen = false;
        let onlineChoicesOpen = false;
        let currentRoom = null;
        let playerId = Math.random().toString(36).substring(7);
        let pollInterval = null;

        // ========== ØªÙ„Ú¯Ø±Ø§Ù… WebApp ==========
        function initTelegram() {
            if (window.Telegram && Telegram.WebApp) {
                const tg = Telegram.WebApp;
                tg.expand();
                tg.ready();
                
                const user = tg.initDataUnsafe?.user;
                if (user) {
                    userData.name = user.first_name + (user.last_name ? ' ' + user.last_name : '');
                    if (user.photo_url) {
                        document.getElementById('avatarImg').innerHTML = `<img src="${user.photo_url}" style="width:100%;height:100%;object-fit:cover;">`;
                    }
                }
            }
            loadUserData();
            // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¨Ø®Ø´ Ø¨Ø§Øª Ø¨Ù‡ ØµÙˆØ±Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶
            showSection('bot');
            document.querySelector('.mode-option').classList.add('active');
        }

        // ========== localStorage ==========
        function loadUserData() {
            const saved = localStorage.getItem('arena_complete_data');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    userData = { ...userData, ...parsed };
                } catch (e) {}
            }
            updateAllDisplays();
        }

        function saveUserData() {
            localStorage.setItem('arena_complete_data', JSON.stringify(userData));
        }

        // ========== Ø¢Ù¾Ø¯ÛŒØª Ù†Ù…Ø§ÛŒØ´â€ŒÙ‡Ø§ ==========
        function updateAllDisplays() {
            document.getElementById('userName').innerHTML = userData.name;
            document.getElementById('userWins').innerHTML = userData.wins;
            document.getElementById('userLevel').innerHTML = userData.level;
            document.getElementById('userCoins').innerHTML = `ğŸ’° ${userData.coins}`;
            document.getElementById('playerScore').innerHTML = userData.gameStats.playerScore;
            document.getElementById('botScore').innerHTML = userData.gameStats.botScore;
            document.getElementById('streakDisplay').innerHTML = userData.streak;
            
            const frame = frames.find(f => f.id === userData.currentFrame);
            if (frame) {
                document.getElementById('avatarFrame').className = `avatar-frame ${frame.class}`;
            }
            
            renderShop();
            renderChoices();
            renderOnlineChoices();
            renderGuide();
        }

        // ========== ØªØºÛŒÛŒØ± Ø¨Ø®Ø´â€ŒÙ‡Ø§ ==========
        function showSection(section) {
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.game-section, .shop-section').forEach(el => el.classList.remove('active'));
            
            if (section === 'bot') {
                document.querySelectorAll('.nav-btn')[0].classList.add('active');
                document.getElementById('botSection').classList.add('active');
            } else if (section === 'online') {
                document.querySelectorAll('.nav-btn')[1].classList.add('active');
                document.getElementById('onlineSection').classList.add('active');
            } else if (section === 'shop') {
                document.getElementById('shopSection').classList.add('active');
            }
        }

        // ========== ØªÙ… ==========
        function toggleTheme() {
            const current = document.body.getAttribute('data-theme');
            const newTheme = current === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            const knob = document.getElementById('themeKnob');
            if (newTheme === 'dark') {
                knob.classList.add('dark');
            } else {
                knob.classList.remove('dark');
            }
        }

        // ========== Ø­Ø§Ù„Øª Ø¨Ø§Ø²ÛŒ ==========
        function setGameMode(mode) {
            currentMode = mode;
            document.querySelectorAll('#botSection .mode-option').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Ù†Ù…Ø§ÛŒØ´ ÛŒØ§ Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ø±Ø§Ù‡Ù†Ù…Ø§
            const guideBtn = document.getElementById('advancedGuideBtn');
            if (mode === 'advanced') {
                guideBtn.style.display = 'block';
            } else {
                guideBtn.style.display = 'none';
                closeGuide();
            }
            
            renderChoices();
            closeChoices();
        }

        function setOnlineMode(mode) {
            onlineMode = mode;
            document.querySelectorAll('#onlineSection .mode-option').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderOnlineChoices();
        }

        // ========== Ø§Ù†ØªØ®Ø§Ø¨ Ø¹Ù†Ø§ØµØ± Ø¯Ø± Ø¨Ø§Ø²ÛŒ Ø¨Ø§ Ø±Ø¨Ø§Øª ==========
        function toggleChoices() {
            choicesOpen = !choicesOpen;
            const wrapper = document.getElementById('choicesWrapper');
            const arrow = document.getElementById('arrowIcon');
            const arrow2 = document.getElementById('arrowIcon2');
            
            if (choicesOpen) {
                wrapper.classList.add('open');
                arrow.style.transform = 'rotate(180deg)';
                arrow2.style.transform = 'rotate(180deg)';
                document.getElementById('btnText').innerHTML = 'Ø¨Ø³ØªÙ† Ù…Ù†Ùˆ';
            } else {
                wrapper.classList.remove('open');
                arrow.style.transform = 'rotate(0deg)';
                arrow2.style.transform = 'rotate(0deg)';
                document.getElementById('btnText').innerHTML = 'Ø¹Ù†Ø§ØµØ± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯';
            }
        }

        function closeChoices() {
            if (choicesOpen) toggleChoices();
        }

        function renderChoices() {
            const grid = document.getElementById('choicesGrid');
            const currentElements = elements[currentMode];
            
            grid.innerHTML = currentElements.map((el, index) => `
                <div class="choice-item" onclick="selectChoice('${el.name}', '${el.emoji}')" style="animation-delay: ${index * 0.1}s">
                    <span class="choice-emoji">${el.emoji}</span>
                    <span class="choice-name">${el.name}</span>
                </div>
            `).join('');
        }

        function selectChoice(playerChoice, playerEmoji) {
            if (navigator.vibrate) navigator.vibrate(50);
            
            document.getElementById('playerChoice').innerHTML = playerEmoji;
            
            const currentElements = elements[currentMode];
            const botElement = currentElements[Math.floor(Math.random() * currentElements.length)];
            document.getElementById('botChoice').innerHTML = botElement.emoji;
            
            const result = determineWinner(playerChoice, botElement.name, currentMode);
            const resultDiv = document.getElementById('resultMessage');
            
            if (result === 'Ø¨Ø±Ø¯') {
                resultDiv.innerHTML = 'ğŸ† Ø¨Ø±Ø¯ÛŒ! +Û±Û° Ø³Ú©Ù‡';
                userData.gameStats.playerScore++;
                userData.wins++;
                userData.coins += 10;
                userData.streak++;
                userData.level = Math.floor(userData.wins / 10) + 1;
                if (navigator.vibrate) navigator.vibrate([100, 50, 100]);
            } else if (result === 'Ø¨Ø§Ø®Øª') {
                resultDiv.innerHTML = 'ğŸ’” Ø¨Ø§Ø®ØªÛŒ!';
                userData.gameStats.botScore++;
                userData.streak = 0;
                if (navigator.vibrate) navigator.vibrate(200);
            } else {
                resultDiv.innerHTML = 'ğŸ¤ Ù…Ø³Ø§ÙˆÛŒ!';
                userData.streak = 0;
                if (navigator.vibrate) navigator.vibrate(30);
            }
            
            saveUserData();
            updateAllDisplays();
            setTimeout(() => closeChoices(), 300);
        }

        function determineWinner(player, opponent, mode) {
            if (player === opponent) return 'Ù…Ø³Ø§ÙˆÛŒ';
            
            if (mode === 'easy') {
                if (player === 'Ø³Ù†Ú¯' && opponent === 'Ù‚ÛŒÚ†ÛŒ') return 'Ø¨Ø±Ø¯';
                if (player === 'Ú©Ø§ØºØ°' && opponent === 'Ø³Ù†Ú¯') return 'Ø¨Ø±Ø¯';
                if (player === 'Ù‚ÛŒÚ†ÛŒ' && opponent === 'Ú©Ø§ØºØ°') return 'Ø¨Ø±Ø¯';
                return 'Ø¨Ø§Ø®Øª';
            } else {
                const rule = advancedRules[player];
                if (rule.wins.includes(opponent)) return 'Ø¨Ø±Ø¯';
                if (rule.loses.includes(opponent)) return 'Ø¨Ø§Ø®Øª';
                return 'Ù…Ø³Ø§ÙˆÛŒ';
            }
        }

        // ========== Ø±Ø§Ù‡Ù†Ù…Ø§ ==========
        function toggleGuide() {
            guideOpen = !guideOpen;
            const wrapper = document.getElementById('guideWrapper');
            const arrow = document.getElementById('guideArrow');
            
            if (guideOpen) {
                wrapper.classList.add('open');
                arrow.style.transform = 'rotate(180deg)';
            } else {
                wrapper.classList.remove('open');
                arrow.style.transform = 'rotate(0deg)';
            }
        }

        function closeGuide() {
            if (guideOpen) toggleGuide();
        }

        function renderGuide() {
            const grid = document.getElementById('guideGrid');
            const elements_list = Object.keys(advancedRules);
            
            grid.innerHTML = elements_list.map(el => {
                const rule = advancedRules[el];
                const emoji = getEmoji(el);
                return `
                    <div class="guide-item" onclick="toggleGuideItem(this)">
                        <div class="guide-header">
                            <span>${emoji}</span>
                            <span>${el}</span>
                        </div>
                        <div class="guide-details">
                            <div class="guide-wins">âœ… Ù…ÛŒâ€ŒØ¨Ø±Ø¯: ${rule.wins.map(w => getEmoji(w)).join(' ')}</div>
                            <div class="guide-loses">âŒ Ù…ÛŒâ€ŒØ¨Ø§Ø²Ø¯: ${rule.loses.map(l => getEmoji(l)).join(' ')}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function toggleGuideItem(item) {
            item.classList.toggle('active');
        }

        function getEmoji(name) {
            const emojiMap = {
                'Ú¯Ø±Ú¯': 'ğŸº', 'Ø¯Ø±Ø®Øª': 'ğŸŒ³', 'Ø§Ù†Ø³Ø§Ù†': 'ğŸ‘¤', 'Ù…Ø§Ø±': 'ğŸ', 'Ù‚ÛŒÚ†ÛŒ': 'âœ‚ï¸',
                'Ø¢ØªØ´': 'ğŸ”¥', 'Ø³Ù†Ú¯': 'ğŸª¨', 'ØªÙÙ†Ú¯': 'ğŸ”«', 'ØµØ§Ø¹Ù‚Ù‡': 'âš¡', 'Ø´ÛŒØ·Ø§Ù†': 'ğŸ˜ˆ',
                'Ø§Ú˜Ø¯Ù‡Ø§': 'ğŸ‰', 'Ø¢Ø¨': 'ğŸ’§', 'Ø¨Ø§Ø¯': 'ğŸŒªï¸', 'Ú©Ø§ØºØ°': 'ğŸ“„', 'Ø§Ø³ÙÙ†Ø¬': 'ğŸ§½'
            };
            return emojiMap[name] || 'â“';
        }

        // ========== Ø¨Ø§Ø²ÛŒ Ø¢Ù†Ù„Ø§ÛŒÙ† ==========
        function toggleOnlineChoices() {
            onlineChoicesOpen = !onlineChoicesOpen;
            const wrapper = document.getElementById('onlineChoicesWrapper');
            const arrow = document.getElementById('onlineArrowIcon');
            
            if (onlineChoicesOpen) {
                wrapper.classList.add('open');
                arrow.style.transform = 'rotate(180deg)';
                document.getElementById('onlineBtnText').innerHTML = 'Ø¨Ø³ØªÙ† Ù…Ù†Ùˆ';
            } else {
                wrapper.classList.remove('open');
                arrow.style.transform = 'rotate(0deg)';
                document.getElementById('onlineBtnText').innerHTML = 'Ø¹Ù†Ø§ØµØ± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯';
            }
        }

        function renderOnlineChoices() {
            const grid = document.getElementById('onlineChoicesGrid');
            const currentElements = elements[onlineMode];
            
            grid.innerHTML = currentElements.map((el, index) => `
                <div class="choice-item" onclick="selectOnlineChoice('${el.name}', '${el.emoji}')" style="animation-delay: ${index * 0.1}s">
                    <span class="choice-emoji">${el.emoji}</span>
                    <span class="choice-name">${el.name}</span>
                </div>
            `).join('');
        }

        function createRoom() {
            const roomId = Math.random().toString(36).substring(2, 8).toUpperCase();
            document.getElementById('roomId').value = roomId;
            
            currentRoom = roomId;
            const gameState = {
                room: roomId,
                players: { [playerId]: { name: userData.name, ready: false } },
                choices: {},
                mode: onlineMode
            };
            
            localStorage.setItem(`game_${roomId}`, JSON.stringify(gameState));
            
            document.getElementById('onlineGameArea').style.display = 'block';
            document.getElementById('waitingLoader').style.display = 'flex';
            startPolling(roomId);
        }

        function joinRoom() {
            const roomId = document.getElementById('roomId').value.toUpperCase();
            if (!roomId) {
                alert('Ù„Ø·ÙØ§Ù‹ Ú©Ø¯ Ø§ØªØ§Ù‚ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯!');
                return;
            }
            
            const saved = localStorage.getItem(`game_${roomId}`);
            if (!saved) {
                alert('Ø§ØªØ§Ù‚ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ú©Ø¯ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯!');
                return;
            }
            
            currentRoom = roomId;
            const gameState = JSON.parse(saved);
            
            if (Object.keys(gameState.players).length >= 2) {
                alert('Ø§ØªØ§Ù‚ Ù¾Ø± Ø§Ø³Øª!');
                return;
            }
            
            gameState.players[playerId] = { name: userData.name, ready: false };
            localStorage.setItem(`game_${roomId}`, JSON.stringify(gameState));
            
            document.getElementById('onlineGameArea').style.display = 'block';
            document.getElementById('waitingLoader').style.display = 'none';
            startPolling(roomId);
        }

        function startPolling(roomId) {
            if (pollInterval) clearInterval(pollInterval);
            
            pollInterval = setInterval(() => {
                if (!currentRoom) return;
                
                const saved = localStorage.getItem(`game_${currentRoom}`);
                if (saved) {
                    const state = JSON.parse(saved);
                    
                    if (state.choices && state.choices[playerId]) {
                        const choice = state.choices[playerId];
                        const elements_list = elements[state.mode || 'easy'];
                        const element = elements_list.find(e => e.name === choice);
                        if (element) {
                            document.getElementById('onlinePlayerChoice').innerHTML = element.emoji;
                        }
                    }
                    
                    const opponentId = Object.keys(state.players || {}).find(id => id !== playerId);
                    if (opponentId && state.choices && state.choices[opponentId]) {
                        document.getElementById('waitingLoader').style.display = 'none';
                        const choice = state.choices[opponentId];
                        const elements_list = elements[state.mode || 'easy'];
                        const element = elements_list.find(e => e.name === choice);
                        if (element) {
                            document.getElementById('onlineOpponentChoice').innerHTML = element.emoji;
                            
                            if (state.choices[playerId]) {
                                const result = determineWinner(state.choices[playerId], choice, state.mode || 'easy');
                                let resultText = '';
                                if (result === 'Ø¨Ø±Ø¯') resultText = 'ğŸ† Ø´Ù…Ø§ Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯ÛŒØ¯!';
                                else if (result === 'Ø¨Ø§Ø®Øª') resultText = 'ğŸ’” Ø­Ø±ÛŒÙ Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯!';
                                else resultText = 'ğŸ¤ Ù…Ø³Ø§ÙˆÛŒ!';
                                document.getElementById('onlineResult').innerHTML = resultText;
                            }
                        }
                    } else {
                        document.getElementById('onlineOpponentChoice').innerHTML = 'â“';
                        if (Object.keys(state.players).length < 2) {
                            document.getElementById('waitingLoader').style.display = 'flex';
                            document.getElementById('onlineResult').innerHTML = 'Ù…Ù†ØªØ¸Ø± Ø­Ø±ÛŒÙ...';
                        }
                    }
                }
            }, 1000);
        }

        function selectOnlineChoice(choice, emoji) {
            if (!currentRoom) {
                alert('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø¨Ù‡ ÛŒÚ© Ø§ØªØ§Ù‚ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯!');
                return;
            }
            
            document.getElementById('onlinePlayerChoice').innerHTML = emoji;
            
            const saved = localStorage.getItem(`game_${currentRoom}`);
            if (saved) {
                const state = JSON.parse(saved);
                if (!state.choices) state.choices = {};
                state.choices[playerId] = choice;
                localStorage.setItem(`game_${currentRoom}`, JSON.stringify(state));
            }
            
            if (onlineChoicesOpen) toggleOnlineChoices();
        }

        function leaveRoom() {
            if (currentRoom) {
                const saved = localStorage.getItem(`game_${currentRoom}`);
                if (saved) {
                    const state = JSON.parse(saved);
                    delete state.players[playerId];
                    if (state.choices) delete state.choices[playerId];
                    if (Object.keys(state.players).length === 0) {
                        localStorage.removeItem(`game_${currentRoom}`);
                    } else {
                        localStorage.setItem(`game_${currentRoom}`, JSON.stringify(state));
                    }
                }
            }
            
            if (pollInterval) clearInterval(pollInterval);
            currentRoom = null;
            document.getElementById('onlineGameArea').style.display = 'none';
            document.getElementById('waitingLoader').style.display = 'none';
        }

        // ========== ÙØ±ÙˆØ´Ú¯Ø§Ù‡ ==========
        function renderShop() {
            const list = document.getElementById('framesList');
            list.innerHTML = frames.map(frame => {
                const isOwned = userData.ownedFrames.includes(frame.id);
                const canBuy = userData.coins >= frame.price && !isOwned;
                return `
                    <div class="frame-item">
                        <div class="frame-preview">
                            <div class="preview-frame ${frame.class}"></div>
                            <div class="preview-avatar">${frame.id}</div>
                        </div>
                        <div class="frame-info">
                            <div class="frame-name">${frame.name}</div>
                            <div class="frame-price">ğŸ’° ${frame.price}</div>
                        </div>
                        ${isOwned ? 
                            `<button class="buy-btn owned" onclick="selectFrame(${frame.id})" ${userData.currentFrame === frame.id ? 'disabled' : ''}>
                                ${userData.currentFrame === frame.id ? 'Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡' : 'Ø§Ù†ØªØ®Ø§Ø¨'}
                            </button>` : 
                            `<button class="buy-btn" onclick="buyFrame(${frame.id})" ${!canBuy ? 'disabled' : ''}>
                                ${canBuy ? 'Ø®Ø±ÛŒØ¯' : 'Ù†Ø¯Ø§Ø±ÛŒ'}
                            </button>`
                        }
                    </div>
                `;
            }).join('');
        }

        function buyFrame(id) {
            const frame = frames.find(f => f.id === id);
            if (userData.coins >= frame.price) {
                userData.coins -= frame.price;
                userData.ownedFrames.push(id);
                saveUserData();
                renderShop();
                updateAllDisplays();
            }
        }

        function selectFrame(id) {
            userData.currentFrame = id;
            saveUserData();
            updateAllDisplays();
            renderShop();
        }

        // ========== Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ==========
        window.onload = function() {
            initTelegram();
            
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.body.setAttribute('data-theme', savedTheme);
            
            const knob = document.getElementById('themeKnob');
            if (savedTheme === 'dark') {
                knob.classList.add('dark');
            } else {
                knob.classList.remove('dark');
            }
            
            // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¨Ø®Ø´ Ø¨Ø§Øª
            showSection('bot');
            document.querySelector('#botSection .mode-option').classList.add('active');
        };
    </script>
</body>
</html>
